import sharp from"sharp";import redirect from"./rd.js";sharp.cache(false);sharp.concurrency(1);export default function comp(req,res,input){const format="jpeg";input.pipe(sharp().grayscale(req.params.grayscale).toFormat(format,{quality:req.params.quality}).toBuffer((err,output,info)=>{if(err||!info){redirect(req,res);return}res.setHeader("content-type","image/"+format);res.setHeader("content-length",info.size);res.setHeader("x-original-size",req.params.originSize);res.setHeader("x-bytes-saved",req.params.originSize-info.size);res.status(200);res.write(output);res.end()}))}
